<!DOCTYPE html>
<html>
  <head>
    <title>Saberchat</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/main.css">
    <!-- link css for navbar. Don't need to include public/javascript/userForm.js since user is already logged in and does not need to access login and register forms.  -->
    <link rel="stylesheet" href="/stylesheets/components/navbar.css">
    <link rel="stylesheet" href="/stylesheets/chat/edit.css">
    <link rel="stylesheet" href="/stylesheets/inbox/sendNotif.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="../javascript/socket.js"></script>

    <!-- I'm using my fontawesome kit -->
    <script src="https://kit.fontawesome.com/dccc745c41.js" crossorigin="anonymous"></script>

    <!-- include the navbar via ejs -->
    <%- include('../partials/navbar') %>
    </head>
    <body style="text-align: center;">
      <div class="container mt-5">
        <div class="row">
          <div class="col-12">
            <div class="jumbotron text-center">
              <h1><i class="far fa-comment-dots"></i> Send Notifications</h1>
              <p>Send notifications to individuals, groups, or via the anonymous hotline</p>
            </div>
          </div>
        </div>
      </div>
        <div class="body">
            <div class="row">
                <div class="col-md-10 offset-md-1 col-12">

                    <!-- Send notification to individual -->
                    <div class="send-notif-type">
                      <h5 class="send-notif-header" style="text-align: center;">Individual</h5>
                      <form action="/send_individual" method="post">
                        <select id="recipient" name="recipient">
                          <optgroup label="Recipient"></optgroup>
                          <option>everyone</option>
                          <%users.forEach(user => { %>
                            <% if (user.username != currentUser.username) { %>
                              <option><%=user.username%></option>
                            <% } %>
                          <% }) %>
                        </select>

                        <select id="type" name="type" style="margin-bottom: 20px;">
                          <optgroup label="Message Type"></optgroup>
                          <%types.forEach(type => { %>
                            <option><%=type%></option>
                          <% }) %>
                        </select>
                        <br />
                        <textarea class="message" name="message" cols="40" rows="5" placeholder="Enter notification"></textarea>
                        <br />
                        <button style=" margin-bottom: 10px;" class="btn btn-primary" class='submit-button' action="submit">Send Notification</button>
                      </form>
                    </div>

                    <!-- Anonymous Hotline -->
                    <div class="send-notif-type">
                      <h5 class="send-notif-header" style="text-align: center;">Anonymous Hotline</h5>
                      <form action="/send_anonymous" method="post">
                        <select id="recipient" name="recipient" style="margin-bottom: 20px;">
                          <optgroup label="Recipient"></optgroup>
                          <%users.forEach(user => { %>
                            <% if (user.username != currentUser.username) { %>
                              <option><%=user.username%></option>
                            <% } %>
                          <% }) %>
                        </select>
                        <br />
                        <textarea class="message" name="message" cols="40" rows="5" placeholder="Enter notification (Your name will not be revealed)"></textarea>
                        <br />
                        <button style=" margin-bottom: 10px;" class="btn btn-primary" class='submit-button' action="submit">Send Notification</button>
                      </form>
                    </div>

                    <!-- Send notification to group -->
                    <br />
                    <div class="send-notif-type" style="margin-top: 20px; text-align: center;">
                      <h5 class="send-notif-header">Group</h5>
                      <form action="/send_group" method="post">
                        <select id="recipients" style="margin-bottom: 20px;">
                          <optgroup label="Add Recipients to Mailing List"></optgroup>
                          <%users.forEach(user => { %>
                            <% if (user.username != currentUser.username) { %>
                              <option><%=user.username%></option>
                            <% } %>
                          <% }) %>
                        </select>
                        <br />
                        <input name="recipient_list"id="recipient_list" type="text" placeholder="Mailing List" style="width: 400px; margin-bottom: 25px; color: blue; font-size: 15px;" readonly/>
                        <button type="button" class="btn btn-danger" id="clear">Clear Field</button>
                        <br /><br />
                        <textarea class="message" name="message" cols="40" rows="5" placeholder="Enter notification"></textarea>
                        <br />
                        <button class="btn btn-primary" class='submit-button' action="submit" style="margin-bottom: 10px;">Send Notification</button>
                      </form>
                    </div>
                </div>
            </div>
        </div>
  </body>

  <script>

  let recipients = document.getElementById('recipients')
  let recipient_list = document.getElementById('recipient_list')
  let clear = document.getElementById('clear')

  recipients.onchange = () => {
    let x = recipients.value;
    if (recipient_list.value == '') {
      recipient_list.value += `${x}`
    } else {
      recipient_list.value += `, ${x}`
    }
  }

  clear.addEventListener('click', () => {
    recipient_list.value = ""
  })

  </script>

</html>

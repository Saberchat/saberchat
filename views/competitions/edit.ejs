<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Saberchat</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="/stylesheets/main.css">

    <link rel="stylesheet" href="/stylesheets/components/header.css">
    <link rel="stylesheet" href="/stylesheets/components/navbar.css">
    <link rel="stylesheet" href="/stylesheets/announcements/form.css">
    <link rel="stylesheet" href="/stylesheets/announcements/edit.css">
    <%if (currentUser) {%>
      <%if (currentUser.darkmode) { %>
        <link rel="stylesheet" href="/stylesheets/darkmode.css">
      <%}%>
    <%}%>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/@popperjs/core@2" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
            integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
            crossorigin="anonymous"></script>

    <script src="https://kit.fontawesome.com/dccc745c41.js" crossorigin="anonymous"></script>
    <%- include('../partials/analytics') %>
  </head>
  <body class="mode">
    <%- include('../partials/navbar') %>
    <%- include('../partials/header') %>

<div class="container my-5">
    <div class="row">
        <div class="col-12">
          <div class="jumbotron text-center header">
            <h1><i class="fas fa-cog"></i> Edit Competition Information</h1>
            <a href="/competitions/<%=competition._id%>" class="btn btn-primary"><i class="fas fa-arrow-left"></i> Back</a>
          </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-8 offset-md-2 col-12">
          <form action="/competitions/<%= competition._id %>?_method=put" method="post" enctype="multipart/form-data">
            <div class="form-group mode">
              <label for="subject">Subject</label>
              <input type="text" class="form-control mode" name="subject" placeholder="A short title..." maxlength="50" required value="<%= competition.subject %>">
            </div>
            <div class="form-group mode">
              <label for="message">Message</label>
              <textarea class="form-control mode" name="message" rows="5" placeholder="What it is about..." required><%= competition.text %></textarea>
            </div>

            <div class="form-group mode">
              <label for="update-time-input">Date/Deadline</label><br/>
              <select name="month" class="mode" style="width: 30%;">
              <% let months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];%>
              <% for (let month of months) { %>
                  <option value="<%=months.indexOf(month)%>" <% if (competition.deadline.month == months.indexOf(month)) {%> selected <% } %>><%=month%></option>
              <% } %>
              </select>
              <select name="day" class="mode" style="width: 10%;">
              <% for (let i = 1; i <= 31; i++) { %>
                  <option value="<%=i%>" <% if (competition.deadline.day == i) {%> selected <% } %>><%=i%></option>
              <% } %>
              </select>
              <select name="year" class="mode" style="width: 10%;">
                <% let year;%>
                <% for (let i = 0; i <= 5; i++) { %>
                    <% year = parseInt((new Date()).toString().split(' ')[3]);%>
                    <option value="<%=year+i%>" <% if (parseInt(competition.deadline.year) == year+i) {%> selected <% } %>><%=year+i%></option>
                <% } %>
                </select>
          </div><br>

            <div id="slide-header">
              <button type="button" onclick="addSlide()" class="btn btn-primary"><i class="fas fa-plus"></i> Link</button>
              <br/><br/>
            </div>
            <div id="links">
              <% let reversedSlides = competition.links.reverse() %>
              <% for( let i = 0; i < reversedSlides.length; i++ ) { %>
                  <div class="image-group" id="slideblock-<%= reversedSlides.length - (i + 1) %>">
                      <div class="input-container">
                          <input type="text" id="<%= reversedSlides.length - (i + 1) %>" class="form-control"
                                 oninput="createSlide(this)" placeholder="Url..."
                                 name="links[<%= reversedSlides.length - (i + 1) %>]" required
                                 value="<%= reversedSlides[i] %>">
                      </div>
                      <button type="button" style="float: right;" onclick="deleteSlide(this)" class="btn btn-danger">
                          <i class="fas fa-minus"></i>
                      </button>
                  </div>
              <% } %>
          </div>

            <% for (let media of competition.mediaFiles) { %>
              <% if(media.filename) { %>
                  <% if ([".png", ".jpg", ".jpeg", ".gif"].includes(fileExtensions.get(media.url).toLowerCase())) { %>
                      <img src="<%= media.url %>" alt="attached image" class="img-fluid rounded past-upload">
                  <% } else if ([".mp3", ".m4a"].includes(fileExtensions.get(media.url).toLowerCase())) { %>
                      <audio controls>
                          <source src="<%=media.url%>" type="audio/mpeg"></source>
                      </audio>
                  <% } else if (fileExtensions.get(media.url).toLowerCase() == ".mp4") {%>
                      <video width="800px" height="500px" src="<%=media.url%>" type="video/*" controls></video>
                  <% } else if ([".mov", ".heic"].includes(fileExtensions.get(media.url).toLowerCase())) {%>
                      <a href="<%=media.url%>" download><h5><i class="fas fa-paperclip"></i> Download "<%=media.originalName%>"</h5></a>
                  <% } else if (fileExtensions.get(media.url).toLowerCase() == ".pdf") {%>
                      <a href="<%=media.url%>" target="_blank"><h5>Open "<%=media.originalName%>" In New Tab  </h5></a>
                  <% } %>
                  <div class="form-check">
                      <input type="checkbox" name="deleteUpload-<%=media.url%>" id="deleteUpload-<%=media.url%>" class="form-check-input">
                      <label class="form-check-label" for="deleteUpload-<%=media.url%>">Remove uploaded media</label>
                  </div>
                  <br />
              <% } %>
          <% } %>

          <div id="media-header">
              <button type="button" onclick="upload(<%=competition.mediaFiles.length%>)" class="btn btn-primary"><i class="fas fa-plus"></i> File Upload</button>
              <br/><br/>
            </div>
          <div id="uploads"></div>

          <div id="image-header">
              <button type="button" onclick="addImg()" class="btn btn-primary"><i class="fas fa-plus"></i> Image URL</button>
              <br/><br/>
          </div>

          <div id="image-block">
              <% let reversedImages = competition.images.reverse() %>
              <% for( let i = 0; i < reversedImages.length; i++ ) { %>
                  <div class="image-group">
                      <div class="input-container" id="imageblock-<%= reversedImages.length - (i + 1) %>">
                          <input type="text" id="<%= reversedImages.length - (i + 1) %>" class="form-control"
                                 oninput="createImg(this)" placeholder="Url..."
                                 name="images[<%= reversedImages.length - (i + 1) %>]" required
                                 value="<%= reversedImages[i] %>">
                          <img id="image-<%= reversedImages.length - (i + 1) %>"
                               style="width: 50%; height: 50%; margin-top: 10px; border-radius: 15px;"
                               src="<%= reversedImages[i] %>" alt="Image Does Not Exist"/>
                      </div>
                      <button type="button" onclick="deleteImg(this)" class="btn btn-danger">
                          <i class="fas fa-minus"></i>
                      </button>
                  </div>
              <% } %>
          </div>

            <button type="submit" class="btn btn-info btn-block">Save Changes</button>
        </form>
    </div>
  </div>
</div>
</div>
<script src="/javascript/slide-url.js"></script>
<script src="/javascript/upload-input.js"></script>
<script src="/javascript/image-url.js"></script>
</body>
</html>

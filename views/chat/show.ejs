<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport">
  <title>Saberchat</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <!-- link chat stylesheet -->
  <link rel="stylesheet" href="/stylesheets/chat/show.css">
  <link rel="stylesheet" href="/stylesheets/components/navbar.css">

  <!-- using my fontawesome kit -->
  <script src="https://kit.fontawesome.com/dccc745c41.js" crossorigin="anonymous"></script>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-dateFormat/1.0/jquery.dateFormat.min.js"></script>

  <!-- script for socket io chat -->
  <script src="/javascript/socket.js"></script>
</head>
<body>
  <%- include("../partials/navbar") %>
  <div class="container py-5 px-4">
    <header class="text-center">
        <h1 class="display-4 text-white">Chat Group Name</h1>
        <p class="text-white lead mb-0">Chat Group Desc.</p>
    </header>
    <div class="row rounded-lg overflow-hidden shadow mt-2">
      <!-- Chat Box-->
      <div class="col-12 px-0">
        <div class="px-4 py-5 chat-box bg-white" id="message-display">
          <% comments.forEach(comment => { %>
            <% if (comment.author._id.equals(currentUser._id)) { %>
              <!-- Reciever Message-->
              <div class="media w-50 ml-auto mb-3">
                <div class="media-body">
                  <div class="bg-primary rounded py-2 px-3 mb-2">
                    <p class="text-small mb-0 text-white"><%= comment.text %></p>
                  </div>
                  <p class="small text-muted"><%= comment.date %></p>
                </div>
              </div>
            <% } else { %>
              <!-- Sender message -->
              <div class="media w-50 mb-3">
                <img src="<%= comment.author.imageUrl %>" alt="user" width="50" class="rounded-circle">
                <div class="media-body ml-3">
                  <div class="bg-grey rounded py-2 px-3 mb-2">
                    <p class="text-small mb-0 text-dark"><%= comment.text %></p>
                  </div>
                  <p class="small text-muted"><%= comment.date %></p>
                </div>
              </div>
            <% } %>
          <% }) %>
      </div>
      <!-- Typing area -->
      <form class="bg-light" id="message-form">
        <div class="input-group">
          <input id="m" type="text" placeholder="Type a message..." aria-describedby="button-addon2" class="form-control rounded-0 border-0 py-4 bg-light" autocomplete="off">
          <div class="input-group-append">
            <button id="button-addon2" class="btn btn-link"> <i class="fa fa-paper-plane"></i></button>
          </div>
        </div>
      </form>
    </div>
</div>
<script>
  //set all the variables for the chatInit function
  const userId = '<%= currentUser._id %>';
  const username = '<%= currentUser.username %>';
  const userImage = '<%= currentUser.imageUrl %>';
  const messageForm = '#message-form';
  const input = '#m';
  const chatDisplay = '#message-display';
  const room = '<%= room %>';
  // call the chatInit function from public/javascript/socket.js
  chatInit(username, userId, messageForm, input, chatDisplay, room, userImage);
</script>
</body>
</html>